<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Medikamenteninventar 79/907</title>

<style>
:root{
  --bg:#0b0d12;
  --panel:#141722;
  --header:#1a1e30;

  --cyan:#5ad7ff;
  --red:#ff2d55;
  --yellow:#ffd60a;
  --ok:#2ecc71;

  --text:#eef2f7;
  --muted:#9aa4b2;

  --red-glow:0 0 18px rgba(255,45,85,.65);
  --yellow-glow:0 0 16px rgba(255,214,10,.55);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#0b0d12,#0f1220);
  color:var(--text);
}
.wrapper{max-width:1200px;margin:auto;padding:24px;}

header{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:16px;
  flex-wrap:wrap;
  margin-bottom:18px;
}
h1{margin:0;font-size:28px;letter-spacing:.4px;}
.subtitle{margin-top:6px;font-size:13px;color:var(--muted);}

.right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:10px;
}
.actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;}

button{
  background:#1b2033;
  border:1px solid rgba(255,255,255,.10);
  padding:12px 14px;
  font-weight:700;
  letter-spacing:.6px;
  color:var(--text);
  border-radius:12px;
  cursor:pointer;
}
button.active{
  border-color:var(--cyan);
  box-shadow:0 0 14px rgba(90,215,255,.35);
}

.pill{
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  color:var(--muted);
  font-size:12px;
  text-align:right;
}

.panel{
  background:var(--panel);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  overflow:hidden;
}
.tablewrap{overflow:auto;max-height:72vh;}
table{width:100%;border-collapse:collapse;}
thead{
  background:var(--header);
  position:sticky;
  top:0;
  z-index:2;
}
th,td{padding:14px;text-align:left;}
th{font-size:13px;color:var(--muted);letter-spacing:.5px;}
tbody tr{border-bottom:1px solid rgba(255,255,255,.06);}

tbody tr.red{background:rgba(255,45,85,.16);}
tbody tr.red td{color:#ffdbe3;text-shadow:0 0 6px rgba(255,45,85,.65);}
tbody tr.yellow{background:rgba(255,214,10,.14);}
tbody tr.yellow td{color:#fff3b0;}
tbody tr.ok td{color:#e5f8ee;}

.dot{
  width:10px;height:10px;border-radius:50%;
  display:inline-block;margin-right:8px;
}
.dot.red{background:var(--red);box-shadow:var(--red-glow);}
.dot.yellow{background:var(--yellow);box-shadow:var(--yellow-glow);}
.dot.ok{background:var(--ok);box-shadow:0 0 12px rgba(46,204,113,.35);}

tfoot td{
  padding:12px 14px;
  color:var(--muted);
  font-size:12px;
  background:rgba(0,0,0,.12);
}

@media(max-width:720px){
  thead{display:none}
  tr{display:block}
  td{display:block;padding:10px 14px;}
  td::before{
    content:attr(data-label);
    display:block;
    font-size:11px;
    color:var(--muted);
    margin-bottom:4px;
  }
  .right{align-items:flex-start}
  .pill{text-align:left}
}
</style>
</head>

<body>
<div class="wrapper">
  <header>
    <div>
      <h1>Medikamenteninventar 79/907</h1>
      <div class="subtitle">NUR KRITISCHE: rot/gelb · ALLE MEDIKAMENTE: nach Ablaufdatum aufsteigend</div>
    </div>

    <div class="right">
      <div class="pill" id="inventur">Letzte Inventur: 02.02.2026</div>
      <div class="actions">
        <button id="btnCritical" class="active">NUR KRITISCHE</button>
        <button id="btnAll">ALLE MEDIKAMENTE</button>
        <div class="pill" id="counts">–</div>
      </div>
    </div>
  </header>

  <div class="panel">
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Ort</th>
            <th>Menge</th>
            <th>Ablaufdatum</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot>
          <tr><td colspan="5">Stichtag: <span id="today"></span></td></tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<script>
/* ========= Daten: integriert (deine neue Liste) ========= */
const meds = [
  // RTW Ampullarium
  {"name": "Adenosin 6mg/2ml", "ort": "RTW Ampullarium", "ablauf": "2026-09-30", "menge": 6},
  {"name": "Amiodaron 150mg/3ml", "ort": "RTW Ampullarium", "ablauf": "2026-12-31", "menge": 3},
  {"name": "Atropin 0.5mg/1ml", "ort": "RTW Ampullarium", "ablauf": "2026-08-31", "menge": 3},
  {"name": "Histakut 4mg/4ml", "ort": "RTW Ampullarium", "ablauf": "2027-02-28", "menge": 2},
  {"name": "Dibondrin 30mg", "ort": "RTW Ampullarium", "ablauf": "2030-03-31", "menge": 2},
  {"name": "Sintetica 50mg/5ml", "ort": "RTW Ampullarium", "ablauf": "2028-04-30", "menge": 2},
  {"name": "Ketanest S 250mg/10ml", "ort": "RTW Ampullarium", "ablauf": "2027-08-31", "menge": 2},
  {"name": "Anexate", "ort": "RTW Ampullarium", "ablauf": "2027-06-30", "menge": 1},
  {"name": "Midazolam 15mg/3ml", "ort": "RTW Ampullarium", "ablauf": "2028-03-31", "menge": 2},
  {"name": "Nitro Pohl 10mg/ml", "ort": "RTW Ampullarium", "ablauf": "2026-10-31", "menge": 6},
  {"name": "Heparin 1000 IE/ml (10ml)", "ort": "RTW Ampullarium", "ablauf": "2026-05-31", "menge": 1},
  {"name": "Combivent", "ort": "RTW Ampullarium", "ablauf": "2027-02-28", "menge": 2},
  {"name": "Xylanest purum 2%", "ort": "RTW Ampullarium", "ablauf": "2028-06-30", "menge": 1},
  {"name": "Novalgin 2.5g (5ml)", "ort": "RTW Ampullarium", "ablauf": "2028-02-28", "menge": 2},
  {"name": "Beloc 5mg/5ml", "ort": "RTW Ampullarium", "ablauf": "2029-10-31", "menge": 2},
  {"name": "Furon 40mg", "ort": "RTW Ampullarium", "ablauf": "2030-02-28", "menge": 2},
  {"name": "Naloxon 0.4mg/ml", "ort": "RTW Ampullarium", "ablauf": "2026-06-30", "menge": 2},
  {"name": "Noradrenalin Kabi 1mg/ml", "ort": "RTW Ampullarium", "ablauf": "2026-08-31", "menge": 5},
  {"name": "Ondansetron 4mg/2ml", "ort": "RTW Ampullarium", "ablauf": "2027-09-30", "menge": 2},
  {"name": "Noradrenalin 10mg/10ml", "ort": "RTW Ampullarium", "ablauf": "2026-09-30", "menge": 1},
  {"name": "Bricanyl", "ort": "RTW Ampullarium", "ablauf": "2026-06-30", "menge": 1},
  {"name": "Theospirex", "ort": "RTW Ampullarium", "ablauf": "2028-02-28", "menge": 2},
  {"name": "Cyclokapron", "ort": "RTW Ampullarium", "ablauf": "2027-07-31", "menge": 2},
  {"name": "Urapidil 50mg/10ml", "ort": "RTW Ampullarium", "ablauf": "2028-01-31", "menge": 1},
  {"name": "Prednisolut 250mg", "ort": "RTW Ampullarium", "ablauf": "2029-05-31", "menge": 1},
  {"name": "Lösungsmittel für Prednisolut", "ort": "RTW Ampullarium", "ablauf": "2031-01-31", "menge": 1},
  {"name": "Aspirin i.v 500mg", "ort": "RTW Ampullarium", "ablauf": "2026-05-31", "menge": 1},
  {"name": "Lösungsmittel für Aspirin", "ort": "RTW Ampullarium", "ablauf": "2029-01-31", "menge": 1},
  {"name": "L-Adreanin 20ml", "ort": "RTW Ampullarium", "ablauf": "2027-02-28", "menge": 2},
  {"name": "Propofol 1% (20ml)", "ort": "RTW Ampullarium", "ablauf": "2026-05-31", "menge": 2},
  {"name": "Phenylephrin 50myg/ml", "ort": "RTW Ampullarium", "ablauf": "2028-05-31", "menge": 2},
  {"name": "Stesolid 5mg", "ort": "RTW Ampullarium", "ablauf": "2027-11-30", "menge": 1},
  {"name": "Stesolid 10mg", "ort": "RTW Ampullarium", "ablauf": "2027-11-30", "menge": 1},
  {"name": "Berodualin", "ort": "RTW Ampullarium", "ablauf": "2028-03-31", "menge": 1},
  {"name": "Clopidogrel 75mg", "ort": "RTW Ampullarium", "ablauf": "2026-06-30", "menge": 8},
  {"name": "Ticagrelor 90mg", "ort": "RTW Ampullarium", "ablauf": "2028-03-31", "menge": 2},
  {"name": "Aspirin 500mg oral", "ort": "RTW Ampullarium", "ablauf": "2027-11-30", "menge": 2},
   {"name": "Ebrantil 25mg", "ort": "RTW Ampullarium", "ablauf": "2026-06-30", "menge": 2},

  // Apothekerschrank
  {"name": "Penthrop 99.9%", "ort": "Apothekerschrank", "ablauf": "2028-03-31", "menge": 1},
  {"name": "Epipen Erwachsen", "ort": "Apothekerschrank", "ablauf": "2026-08-31", "menge": 1},
  {"name": "Epipen Kinder", "ort": "Apothekerschrank", "ablauf": "2026-08-31", "menge": 1},

  // Wärmefach
  {"name": "NaCl 0.9% 100ml", "ort": "Wärmefach", "ablauf": "2028-02-28", "menge": 2},
  {"name": "G10 250ml", "ort": "Wärmefach", "ablauf": "2027-12-31", "menge": 2},
  {"name": "Aqua a.i 100ml", "ort": "Wärmefach", "ablauf": "2028-04-30", "menge": 2},
  {"name": "Paracetamol 1g/100ml", "ort": "Wärmefach", "ablauf": "2027-06-30", "menge": 2},
  {"name": "NaCl 0.9% 10ml", "ort": "Wärmefach", "ablauf": "2028-06-30", "menge": 3},
  {"name": "NaCl 0.9% 10ml", "ort": "Wärmefach", "ablauf": "2028-07-31", "menge": 7},

  // Kühlfach
  {"name": "Suprarenin 1mg/ml", "ort": "Kühlfach", "ablauf": "2027-11-30", "menge": 5},
  {"name": "Lorazepam Macure 4mg/ml", "ort": "Kühlfach", "ablauf": "2026-11-30", "menge": 2},
  {"name": "Gynipral 10myg/2ml", "ort": "Kühlfach", "ablauf": "2028-04-30", "menge": 2},
  {"name": "Propofol 2% (50ml)", "ort": "Kühlfach", "ablauf": "2028-07-31", "menge": 2},
  {"name": "Rectodelt Zäpfen 100mg", "ort": "Kühlfach", "ablauf": "2028-01-31", "menge": 2},
  {"name": "Mexaratio Zäpfen 250mg", "ort": "Kühlfach", "ablauf": "2029-06-30", "menge": 4},

  // Ampullarium Rucksack
  {"name": "Novalgin 2.5g (5ml)", "ort": "Ampullarium Rucksack", "ablauf": "2028-02-28", "menge": 1},
  {"name": "Atropin 0.5mg/1ml", "ort": "Ampullarium Rucksack", "ablauf": "2027-10-31", "menge": 1},
  {"name": "Beloc 5mg/5ml", "ort": "Ampullarium Rucksack", "ablauf": "2029-10-31", "menge": 2},
  {"name": "Lösungsmittel für Aspirin", "ort": "Ampullarium Rucksack", "ablauf": "2031-01-29", "menge": 1},
  {"name": "Aspirin 500mg oral", "ort": "Ampullarium Rucksack", "ablauf": "2030-11-27", "menge": 2},
  {"name": "Aspirin i.v 500mg", "ort": "Ampullarium Rucksack", "ablauf": "2031-05-26", "menge": 1},
  {"name": "Urapidil 50mg/10ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-01-28", "menge": 2},
  {"name": "Ondansetron 4mg/2ml", "ort": "Ampullarium Rucksack", "ablauf": "2030-08-27", "menge": 2},
  {"name": "Naloxon 0.4mg/ml", "ort": "Ampullarium Rucksack", "ablauf": "2030-06-26", "menge": 1},
  {"name": "Cyclokapron", "ort": "Ampullarium Rucksack", "ablauf": "2031-07-27", "menge": 2},
  {"name": "Physiologische Kochsalzlösung \"Fresenius\" 10ml", "ort": "Ampullarium Rucksack", "ablauf": "2030-04-27", "menge": 5},
  {"name": "Propofol 1% (20ml)", "ort": "Ampullarium Rucksack", "ablauf": "2031-07-28", "menge": 1},
  {"name": "Stesolid 10mg", "ort": "Ampullarium Rucksack", "ablauf": "2030-11-27", "menge": 1},
  {"name": "Stesolid 5mg", "ort": "Ampullarium Rucksack", "ablauf": "2030-11-27", "menge": 1},
  {"name": "NaCl 0.9% 10ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-07-28", "menge": 1},
  {"name": "Combivent", "ort": "Ampullarium Rucksack", "ablauf": "2028-02-27", "menge": 2},
  {"name": "Amiodaron 150mg/3ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-12-26", "menge": 3},
  {"name": "L-Adreanin 20ml", "ort": "Ampullarium Rucksack", "ablauf": "2028-02-27", "menge": 2},
  {"name": "Suprarenin 1mg/ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-05-26", "menge": 5},
  {"name": "Histakut 4mg/4ml", "ort": "Ampullarium Rucksack", "ablauf": "2028-02-27", "menge": 1},
  {"name": "Lösungsmittel für Prednisolut", "ort": "Ampullarium Rucksack", "ablauf": "2031-01-31", "menge": 1},
  {"name": "Prednisolut 250mg", "ort": "Ampullarium Rucksack", "ablauf": "2031-05-29", "menge": 1},
  {"name": "Flumazenil", "ort": "Ampullarium Rucksack", "ablauf": "2030-06-27", "menge": 1},
  {"name": "Ketanest S 50mg/2ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-12-26", "menge": 4},
  {"name": "Midazolam 15mg/3ml", "ort": "Ampullarium Rucksack", "ablauf": "2031-03-28", "menge": 1},
  {"name": "Midazolam-hameln15mg/3mg", "ort": "Ampullarium Rucksack", "ablauf": "2030-04-27", "menge": 1},
  {"name": "NaCl 0.9% 10ml", "ort": "Ampullarium Rucksack", "ablauf": "2030-06-28", "menge": 1},
  {"name": "Epipen Erwachsen", "ort": "Ampullarium Rucksack", "ablauf": "2030-08-26", "menge": 1},
  {"name": "Epipen Kinder", "ort": "Ampullarium Rucksack", "ablauf": "2030-08-28", "menge": 1},
  {"name": "Berodualin", "ort": "Ampullarium Rucksack", "ablauf": "2031-03-28", "menge": 1}
];

/* ========= UI / Logik ========= */
const tbody = document.getElementById("tbody");
const btnCritical = document.getElementById("btnCritical");
const btnAll = document.getElementById("btnAll");
const countsEl = document.getElementById("counts");
const todayEl = document.getElementById("today");

let mode = "critical"; // "critical" | "all"

// Stichtag = "heute" im Browser
const today = new Date();
todayEl.textContent = today.toISOString().slice(0,10);

function sameMonth(a,b){
  return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth();
}
function addMonths(d,m){
  const x=new Date(d);
  const day=x.getDate();
  x.setMonth(x.getMonth()+m);
  if(x.getDate()<day) x.setDate(0);
  return x;
}
function parseExpiry(iso){
  if(!iso || typeof iso !== "string") return null;
  const m = iso.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if(!m) return null;
  return new Date(+m[1], +m[2]-1, +m[3], 12, 0, 0);
}
function classify(m){
  const exp = parseExpiry(m.ablauf);
  if(!exp) return {cls:"red", dot:"red", text:"DATUM FEHLT / PRÜFEN", exp:null};

  if(exp < today || sameMonth(exp, today)){
    return {cls:"red", dot:"red", text: exp < today ? "ABGELAUFEN" : "LÄUFT DIESEN MONAT AB", exp};
  }
  if(exp <= addMonths(today, 1)){
    return {cls:"yellow", dot:"yellow", text:"LÄUFT INNERHALB 1 MONAT AB", exp};
  }
  return {cls:"ok", dot:"ok", text:"OK", exp};
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* Sortierung:
   - mode === "all": Ablaufdatum ASC, fehlende Daten ans Ende
   - mode === "critical": rot vor gelb, dann Ablaufdatum ASC
*/
function sortForAll(a,b){
  const ta = a._cls.exp ? a._cls.exp.getTime() : Number.POSITIVE_INFINITY;
  const tb = b._cls.exp ? b._cls.exp.getTime() : Number.POSITIVE_INFINITY;
  if(ta !== tb) return ta - tb;
  return a.name.localeCompare(b.name, "de");
}
function sortForCritical(a,b){
  const prio = { red:0, yellow:1, ok:2 };
  const pa = prio[a._cls.cls] ?? 9;
  const pb = prio[b._cls.cls] ?? 9;
  if(pa !== pb) return pa - pb;
  return sortForAll(a,b);
}

function render(){
  tbody.innerHTML = "";

  const enriched = meds.map(m => ({...m, _cls: classify(m)}));

  // counts über ALLE
  let red=0,yellow=0,ok=0;
  for(const x of enriched){
    if(x._cls.cls==="red") red++;
    else if(x._cls.cls==="yellow") yellow++;
    else ok++;
  }
  countsEl.textContent = `${enriched.length} gesamt · ${red} rot · ${yellow} gelb · ${ok} ok`;

  let shown;
  if(mode === "all"){
    shown = enriched.slice().sort(sortForAll);
  } else {
    shown = enriched.filter(x => x._cls.cls !== "ok").sort(sortForCritical);
  }

  if(mode === "critical" && shown.length === 0){
    tbody.insertAdjacentHTML("beforeend", `
      <tr class="ok">
        <td colspan="5" style="padding:16px;color:var(--muted);">
          Keine kritischen Abläufe (rot/gelb) im aktuellen Zeitraum.
          Klick auf <strong>ALLE MEDIKAMENTE</strong>, um das komplette Inventar zu sehen.
        </td>
      </tr>
    `);
    return;
  }

  for(const m of shown){
    const s = m._cls;
    tbody.insertAdjacentHTML("beforeend", `
      <tr class="${s.cls}">
        <td data-label="Name">${escapeHtml(m.name)}</td>
        <td data-label="Ort">${escapeHtml(m.ort)}</td>
        <td data-label="Menge">${escapeHtml(String(m.menge))}</td>
        <td data-label="Ablaufdatum">${escapeHtml(m.ablauf || "—")}</td>
        <td data-label="Status"><span class="dot ${s.dot}"></span>${escapeHtml(s.text)}</td>
      </tr>
    `);
  }
}

/* Button-Handling (zwei Buttons) */
btnCritical.addEventListener("click", () => {
  mode = "critical";
  btnCritical.classList.add("active");
  btnAll.classList.remove("active");
  render();
});
btnAll.addEventListener("click", () => {
  mode = "all";
  btnAll.classList.add("active");
  btnCritical.classList.remove("active");
  render();
});

render();
</script>
</body>
</html>
